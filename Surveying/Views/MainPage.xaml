<?xml version="1.0" encoding="utf-8"?>
<ContentPage 
        xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
        xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
        xmlns:syncfusion="clr-namespace:Syncfusion.Maui.DataGrid;assembly=Syncfusion.Maui.DataGrid"
        xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
        xmlns:editors="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
        xmlns:inputLayout="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
        xmlns:local="clr-namespace:Surveying.ViewModels"
        x:Class="Surveying.Views.MainPage"
        Title="Survey List">

    <ContentPage.BindingContext>
        <local:SurveyListViewModel/>
    </ContentPage.BindingContext>

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="DetailLabelStyle" TargetType="Label">
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="MinimumWidthRequest" Value="100" />
            </Style>
            <Style x:Key="DetailValueStyle" TargetType="Label">
                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="LineBreakMode" Value="TailTruncation" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid x:Name="mainLayout" BackgroundColor="Transparent">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <HorizontalStackLayout Grid.Row="0" Padding="10" Spacing="10" HorizontalOptions="Fill">
            <Button x:Name="addSurveyButton" Text="Add Survey" Clicked="OnAddSurveyClicked"/>
            <SearchBar x:Name="searchBar"
                Placeholder="Search..."
                Text="{Binding SearchText, Mode=TwoWay}"
                HorizontalOptions="FillAndExpand" />
        </HorizontalStackLayout>

        <Grid Grid.Row="1" x:Name="contentLayout" BackgroundColor="Transparent">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <syncfusion:SfDataGrid x:Name="dataGrid"
               ItemsSource="{Binding FilteredSurveyList}"
               AllowGroupExpandCollapse="True"
               SelectionMode="Single"
               CellTapped="DataGrid_CellTapped"
               RowHeight="40"
               AutoGenerateColumnsMode="None"
               AllowEditing="True"
               AllowResizingColumns="True"
               HorizontalOptions="FillAndExpand"
               VerticalOptions="FillAndExpand"
               ColumnWidthMode="Fill">
                <syncfusion:SfDataGrid.GroupColumnDescriptions>
                    <syncfusion:GroupColumnDescription ColumnName="OrderNumber"/>
                </syncfusion:SfDataGrid.GroupColumnDescriptions>
                <syncfusion:SfDataGrid.Columns>
                    <syncfusion:DataGridTextColumn HeaderText="Principal" MappingName="PrincipalName" MinimumWidth="120" />
                    <syncfusion:DataGridTextColumn HeaderText="Surveyor" MappingName="Surveyor" MinimumWidth="100" />
                    <syncfusion:DataGridTextColumn HeaderText="Tank" MappingName="ContNumber" MinimumWidth="80" />
                    <syncfusion:DataGridTextColumn HeaderText="Condition" MappingName="Condition" MinimumWidth="100" />
                    <syncfusion:DataGridTextColumn MappingName="Status" HeaderText="C|R|P|S" MinimumWidth="80" />
                </syncfusion:SfDataGrid.Columns>
            </syncfusion:SfDataGrid>

            <ScrollView Grid.Row="1" x:Name="detailsScrollView">
                <Border Stroke="LightGray" Margin="5" Padding="10">
                    <VerticalStackLayout Spacing="15" Padding="10">
                        <Label Text="Details" FontAttributes="Bold" FontSize="24" HorizontalOptions="Center" />

                        <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center">
                            <Label Text="Tank No:" Style="{StaticResource DetailLabelStyle}" />
                            <Label Text="{Binding SelectedSurvey.ContNumber}" Style="{StaticResource DetailValueStyle}" />
                            <Button Text="TestCleaning" Clicked="SfButton_Clicked" Margin="5" />
                        </FlexLayout>

                        <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center">
                            <Label Text="Condition:" Style="{StaticResource DetailLabelStyle}" />
                            <Label Text="{Binding SelectedSurvey.Condition}" Style="{StaticResource DetailValueStyle}" />
                            <Button Text="TestRepair" Clicked="SfButton_Clicked_1" Margin="5" />
                        </FlexLayout>

                        <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center">
                            <Label Text="Surveyor:" Style="{StaticResource DetailLabelStyle}" />
                            <Label Text="{Binding SelectedSurvey.Surveyor}" Style="{StaticResource DetailValueStyle}" />
                            <Button Text="TestPeriodic" Clicked="SfButton_Clicked_2" Margin="5" />
                        </FlexLayout>

                        <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center">
                            <Label Text="OrderDate:" Style="{StaticResource DetailLabelStyle}" />
                            <Label Text="{Binding SelectedSurvey.OrderDate, StringFormat='{}{0:dd/MM/yyyy}'}" Style="{StaticResource DetailValueStyle}" />
                            <Button Text="TestSurvey" Clicked="SfButton_Clicked_3" Margin="5" />
                        </FlexLayout>

                        <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center">
                            <Label Text="SurveyDate:" Style="{StaticResource DetailLabelStyle}" />
                            <Label Text="{Binding SelectedSurvey.SurveyDate, StringFormat='{}{0:dd/MM/yyyy}'}" Style="{StaticResource DetailValueStyle}" />
                        </FlexLayout>

                        <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center">
                            <Label Text="PickupDate:" Style="{StaticResource DetailLabelStyle}" />
                            <Label Text="{Binding SelectedSurvey.PickupDate, StringFormat='{}{0:dd/MM/yyyy}'}" Style="{StaticResource DetailValueStyle}" />
                        </FlexLayout>

                        <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center">
                            <Label Text="Shipper:" Style="{StaticResource DetailLabelStyle}" />
                            <Label Text="{Binding SelectedSurvey.ShipperName}" Style="{StaticResource DetailValueStyle}" />
                        </FlexLayout>
                    </VerticalStackLayout>
                </Border>
            </ScrollView>
        </Grid>
    </Grid>
</ContentPage>